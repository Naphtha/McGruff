<!DOCTYPE html>
<meta charset="utf-8">

<!-- Authored by Shawn Shojaie :) -->

<style>

svg {
  margin: 1rem;
}

.chart rect {
  fill: cornflowerblue;
}
.chart text {
  fill: black;
  font: 10px sans-serif;
  text-anchor: end;
}

.x_axis path, line{
  shape-rendering: crispEdges;
  fill: none;
  stroke: black;
}

.y_axis path, line{
  shape-rendering: crispEdges;
  fill: none;
  stroke: black;
}

.hour_x_axis line{
  shape-rendering: crispEdges;
  fill: none;
  stroke: black;
}

.hour_x_axis path{
  shape-rendering: crispEdges;
  fill-opacity: .25;
  fill: green;
  stroke: none;
}

</style>

<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://code.jquery.com/jquery-1.11.2.min.js" charset="utf-8"></script>



<script>

var height = 400;
var padding = 50;
var barWidth = 20;
var margin = {top: 20, bottom: 20, left: 20, right: 20};
  
// select chart div
var chart = d3.select(".chart").attr("height", height + margin.top + margin.bottom);

// set up date/time format specifier for d3 processing
var format = d3.time.format("%b%d%Y %H:%M");
var hour_minute = d3.time.format("%H:%M");


// load from file
d3.json("log.json", function(jsonfile){

  var data = new Array();
  // for each date in the log file
  for( i in jsonfile ){
    data = data.concat(jsonfile[i]);
  }

  // // scale the graph
  // var x = d3.time.scale()
  // .domain([])
  // .range([0,height]);

  // use custom date parser as accessor for domain
  var x_scale = d3.time.scale()
  .range([0, barWidth * data.length])
  .domain([d3.min(data, function(d){return format.parse(d.time);}), d3.max(data, function(d){return format.parse(d.time);}) ]);

  var y_scale = d3.scale.linear()
  .range([margin.top, height - padding - margin.bottom])
  .domain([0,12]);

  var x_axis = d3.svg.axis()
  .orient("bottom")
  .scale(x_scale)
  .tickFormat(d3.time.format("%b %d %Y %H:%M"))
  .ticks(d3.time.hour, 6)
  .tickSize(20);

  var y_axis = d3.svg.axis()
  .orient("left")
  .scale(y_scale)
  .ticks(12)
  .tickSize(0);

  var hour_x_axis = d3.svg.axis()
  .orient("bottom")
  .scale(x_scale)
  .ticks(d3.time.hour, 1)
  .tickFormat(" ")
  .tickSize(6);


  chart.attr("width", barWidth * data.length + margin.right + margin.left );

  chart.append("g")
  .attr("transform", "translate(20," + (height-padding) + ")")
  .attr("class", "x_axis")
  .call(x_axis);

  chart.append("g")
  .attr("transform", "translate(20," + (height-padding) + ")")
  .attr("class", "hour_x_axis")
  .call(hour_x_axis);

  chart.append("g")
  .attr("transform", "translate(" + (margin.right) + ",0)")
  .attr("class", "y_axis")
  .call(y_axis);

  chart.selectAll("circle")
  .data(data)
  .enter()
  .append("circle")
  .attr("cx", function(d){return x_scale(format.parse(d.time)) + margin.left} )
  .attr("cy", function(d){return y_scale(   hour_conv(d)  )} )
  .attr("r", 2);

  // var bar = chart.selectAll("g").data(data).enter().append("g").attr("transform", function(d,i){ return "translate(0," + i * barWidth + ")";});

  // bar.append("rect").attr("height", function(d){ return x(format.parse(d.time)); }).attr("width", barWidth - 1);

  // bar.append("text").attr("x", height)
  //   .attr("y", barWidth - 5)
  //   .attr("dy", ".35em");
    //.text(function(d){ return d.activity });

});

function type(d){
  d.value = +d.value;
  return d;
}

function hour_conv(data){

  hour = format.parse(data.time).getHours()
  hour = hour|0;
  if(hour > 12){
    return (24 - hour)|0;
  }else{
    return hour|0;
  }
}


</script>

<div>
  This chart shows a dot for every crime committed. Each tick mark is one hour.  
  The code lives at <a href="https://github.com/Naphtha/McGruff">Github</a>. Also if you have any questions on how to do this, feel free to email me firstname.lastname@gmail.com and I can show you some tutorials which I found immensely helpful.
</div>




